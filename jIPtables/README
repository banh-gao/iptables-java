jIPtables - Java library for iptables
by Daniel Zozin <zdenial@gmx.com>

This library provides a communication interface to the iptables firewall, to linux netfilter logger and connection tracker.

The jIPtables rule management system allows to parse, generate and apply the iptables rules to the local linux machine.
The log tracker provides a java notification system for low level netfilter log events.
The connection tracker notifies for established connections and connection state changes.

INSTALLATION
The full implementation of jIPtables requires libnetfilter_log and libnetfilter_conntrack in order to be compiled.
You can download them at http://www.netfilter.org/

On Debian or Ubuntu just run:
sudo apt-get install libnetfilter-log-dev libnetfilter-conntrack-dev

The compilation is executed through an ant script, set the jnidir param to the directory path where your virtual machine jni header files are stored.
If you want to use the full implementation, after installing the required libraries go into the main directory and type:
ant build -Djnidir=VMHeadersDir

If you want only to use the netfilter event logger type:
ant build-log -Djnidir=VMHeadersDir

If you want only to use the netfilter connection tracker type:
ant build-conn -Djnidir=VMHeadersDir

The ant script will generate the compiled library files.

USAGE
To use the library you must include the jar archive in your project and place the compiled library files in a system library directory or in the working directory.

In order to access to the firewall and netfilter functionalities the library needs the CAP_NET_ADMIN capability.
You can set that capability by adding to /etc/security/capability.conf a line like:

cap_net_admin        YOUR-APP-USER

replacing YOUR-APP-USER with the username that runs the application.
You can also assign that capability directly to your java executable with something like:

setcap 'CAP_NET_ADMIN+eip' `readlink -f /usr/bin/java`

however note that this method assigns this capability to any java program using the same java executable.

The library receives log events from the nflog target, its must be setted as the jump target for an iptables rule, the prefix setted with the rule allows to match a log event with a specific rule.
For example to append a rule for logging to the INPUT chain execute:

iptables -A INPUT -j NFLOG --nflog-prefix INDROPPED

The library will be notified when this rule is reached and the logged packet prefix corresponds to INDROPPED